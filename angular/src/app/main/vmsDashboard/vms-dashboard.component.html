<div [@routerTransition]>
    <div class="content d-flex flex-column flex-column-fluid">
        <sub-header [title]="'Daily Dashboards' | localize"
            [description]="'Daily Monitoring Dashboard for visitor of Bank Rakyat' | localize">
            <div role="actions">
                <!-- <button (click)="exportToExcel()" class="btn btn-outline-success">
                    <i class="fa fa-file-excel"></i> {{ l("ExportToExcel") }}
                </button>

                <button *ngIf="isGranted('Pages.CMSDashboards.Create')" (click)="createCMSDashboard()"
                    class="btn btn-primary blue">
                    <i class="fa fa-plus"></i> {{ l("CreateNewCMSDashboard") }}
                </button> -->
            </div>
        </sub-header>

        <div [class]="containerClass">
            <div class="row row-no-padding row-col-separator-xl h-100 mb-3">
                <div class="col">
                    <div class="card card-custom bgi-no-repeat card-stretch new-subscription-statistics h-100">
                        <div class="card-body">
                            <a href="app/main/appointment_Today"
                                class="card-title text-left font-weight-bolder text-dark font-size-h6 mb-4 text-hover-state-dark d-block">
                                Total Appointment
                            </a>
                            <div class="text-left text-primary font-weight-bolder font-size-h2 mr-2">
                                <span counto class="text-primary font-weight-bolder">
                                    {{total.toFixed(0)}}
                                </span>
                            </div>
                            <div class="progress progress-xs mt-7 bg-primary-o-60">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: 100%"
                                    aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="text-left text-dark-75 mt-1 status-title">
                                Total Appointment
                                <!-- {{selectedDateRange[0] | luxonFormat: 'D'}} -
                                {{selectedDateRange[1] | luxonFormat: 'D'}} -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card card-custom bgi-no-repeat card-stretch new-subscription-statistics h-100">
                        <div class="card-body">
                            <a href="app/main/appointment/Appointments?AppointmentID={{branchIdFilter}}&status=1"
                                class="card-title text-left font-weight-bolder text-dark font-size-h6 mb-4 text-hover-state-dark d-block">
                                Check In
                            </a>
                            <div class="text-left text-info font-weight-bolder font-size-h2 mr-2">
                                <!-- <span>...</span> -->
                                <span>{{ checkIn.toFixed(0) }}</span>
                            </div>
                            <div class="progress progress-xs mt-7 bg-info-o-60">
                                <div class="progress-bar bg-info" role="progressbar" [style.width.%]="arriveFrac"
                                    attr.aria-valuenow="arriveFrac" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="text-left text-dark-75 mt-1 status-title">
                                Visitor Check In
                                <span class="counterup">{{arriveFrac.toFixed(2)}}</span>%
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card card-custom bgi-no-repeat card-stretch new-subscription-statistics h-100">
                        <div class="card-body">
                            <a href="app/main/appointment/Appointments?AppointmentID={{branchIdFilter}}&status=2"
                                class="card-title text-left font-weight-bolder text-dark font-size-h6 mb-4 text-hover-state-dark d-block">
                                Check Out
                            </a>
                            <div class="text-left text-success font-weight-bolder font-size-h2 mr-2">
                                <!-- <span *ngIf="!topStatsData">...</span> -->
                                <span>
                                    {{checkOut | number: "1.0-0"}}

                                </span>
                            </div>
                            <div class="progress progress-xs mt-7 bg-success-o-60">
                                <div class="progress-bar bg-success" role="progressbar" [style.width.%]="completeFrac"
                                    attr.aria-valuenow="completefrac" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <span class="text-muted mr-2 font-size-sm font-weight-bold">
                                    Appointment Completed
                                </span>
                                <span class="text-muted font-size-sm font-weight-bold">
                                    <span class="counterup">{{completeFrac.toFixed(2)}}</span>%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card card-custom bgi-no-repeat card-stretch new-subscription-statistics h-100">
                        <div class="card-body">
                            <a href="app/main/appointment/Appointments?AppointmentID={{branchIdFilter}}&status=3"
                                class="card-title text-left font-weight-bolder text-dark font-size-h6 mb-4 text-hover-state-dark d-block">
                                Cancel
                            </a>
                            <div class="text-left text-warning font-weight-bolder font-size-h2 mr-2">
                                <span>
                                    {{cancel | number: "1.0-0"}}</span>
                            </div>
                            <div class="progress progress-xs mt-7 bg-warning-o-60">
                                <div class="progress-bar bg-warning" role="progressbar" [style.width.%]="cancelFrac"
                                    attr.aria-valuenow="cancelfrac" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <span class="text-muted mr-2 font-size-sm font-weight-bold">
                                    Appointment Cancel
                                </span>
                                <span class="text-muted font-size-sm font-weight-bold">
                                    <span class="counterup">{{cancelFrac.toFixed(2)}}</span>%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Add new -->
                <div class="col">
                    <div class="card card-custom bgi-no-repeat card-stretch new-subscription-statistics h-100">
                        <div class="card-body">
                            <a href="app/main/appointment/Appointments?AppointmentID={{branchIdFilter}}&status=4"
                                class="card-title text-left font-weight-bolder text-dark font-size-h6 mb-4 text-hover-state-dark d-block">
                                Miss
                            </a>
                            <div class="text-left text-danger font-weight-bolder font-size-h2 mr-2">
                                <span>
                                    {{miss | number: "1.0-0"}}</span>
                            </div>
                            <div class="progress progress-xs mt-7 bg-danger-o-60">
                                <div class="progress-bar bg-danger" role="progressbar" [style.width.%]="cancelFrac"
                                    attr.aria-valuenow="cancelfrac" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <span class="text-muted mr-2 font-size-sm font-weight-bold">
                                    Appointment Miss
                                </span>
                                <span class="text-muted font-size-sm font-weight-bold">
                                    <span class="counterup">{{missFrac.toFixed(2)}}</span>%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-no-padding row-col-separator-xl h-100">
                <div class="col">
                    <div class="card card-custom gutter-b">
                        <div class="card-body">
                            <form class="form" autocomplete="off">
                                <div>
                                    <div class="row align-items-center">
                                        <div class="col-xl-12">
                                            <div class="form-group m-form__group">
                                                <h6 style="color: blue">Appointment Information on {{appointmentDate}}
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="col-xl-12">
                                            <div class="form-group m-form__group align-items-center">
                                                <div class="input-group">
                                                    <input [(ngModel)]="filterText" name="filterText" autoFocus
                                                        class="form-control m-input" [placeholder]="
                                                            l('SearchWithThreeDot')
                                                        " type="text" />
                                                    <span class="input-group-btn">
                                                        <button (click)="
                                                                getVMSDashboards()
                                                            " class="btn btn-primary" type="submit">
                                                            <i class="flaticon-search-1"></i>
                                                        </button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- <div class="col-md-4">
                                            <div class="form-group m-form__group">
                                                <label for="BranchBranchName">{{
                                                    l("Branch")
                                                    }}</label>
                                                <div class="input-group">
                                                    <input class="form-control" id="branchBranchNameFilter"
                                                    [(ngModel)]="branchBranchNameFilter" name="branchBranchNameFilter" type="text" disabled />
                                                    <div class="input-group-append">
                                                        <button class="btn btn-primary blue"  type="button" (click)="openSelectBranchModal()">
                                                            <i class="fa fa-search"></i>
                                                            {{ l("Pick") }}
                                                        </button>
                                                    </div>
                                                    <div class="input-group-prepend">
                                                        <button class="btn btn-danger btn-icon" type="button"  (click)="setBranchIdNull()">
                                                            <i class="fa fa-times"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <input class="form-control" name="branchIdFilter" type="text" hidden />
                                        </div> -->
                                        <div class="col-md-4">
                                            <div class="form-group m-form__group">
                                                <label for="FullName">{{
                                                    l("FullName")
                                                    }}</label>
                                                <div class="input-group">
                                                    <input class="form-control" id="fullName" [(ngModel)]="fullName"
                                                        name="fullName" type="text" disabled />
                                                </div>
                                            </div>
                                            <input class="form-control" name="branchIdFilter" type="text" hidden />
                                        </div>

                                        <!-- <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="MinAppointmentDateFilter">{{
                                                    l("AppointmentDate")
                                                    }}</label>
                                                <div class="input-group">
                                                    <input class="form-control m-input" id="MinAppointmentDateFilter" [(ngModel)]="minAppointmentDateFilter"
                                                        name="MinAppointmentDateFilter" type="datetime" bsDatepicker
                                                        placeholder="{{
                                                            l('Date')
                                                        }}" />

                                                        <span style="line-height: 40px;padding: 0 15px 0 15px;">
                                                            &mdash;
                                                        </span>
                                                        <input class="form-control m-input" id="MaxAppointmentDateFilter"
                                                            name="MaxAppointmentDateFilter" type="datetime" bsDatepicker
                                                            placeholder="{{l('MaxValue')}}" [(ngModel)]="maxAppointmentDateFilter" />
                                                </div>
                                            </div>
                                        </div> -->

                                        <!-- <div class="col-md-3">
                                            <div class="form-group m-form__group">
                                                <label for="ServiceServiceName">{{
                                                    l("Service")
                                                    }}</label>
                                                <div class="input-group">
                                                    <input class="form-control" id="serviceServiceNameFilter"
                                                        name="serviceServiceNameFilter" [(ngModel)]="
                                                            serviceServiceNameFilter
                                                        " type="text" disabled />
                                                    <div class="input-group-append">
                                                        <button class="btn btn-primary blue" (click)="
                                                                openSelectServiceModal()
                                                            " type="button">
                                                            <i class="fa fa-search"></i>
                                                            {{ l("Pick") }}
                                                        </button>
                                                    </div>
                                                    <div class="input-group-prepend">
                                                        <button class="btn btn-danger btn-icon" type="button"
                                                            (click)="setServiceIdNull()">
                                                            <i class="fa fa-times"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <input class="form-control" name="serviceIdFilter" [(ngModel)]="serviceIdFilter"
                                                type="text" hidden />
                                          </div>

                                          <div class="col-md-3">
                                            <div class="form-group m-form__group">
                                                <label for="BranchBranchName">{{
                                                    l("RegionCode")
                                                    }}</label>
                                                    <select name="Branch_RegionCode" id="Branch_RegionCode" class="form-control" 
                                                     [(ngModel)]="branchCodeIdFilter">
                                                        <option value="" selected>Select Region</option>
                                                        <option *ngFor="let item of regionCodeList" value="{{item.regionCode.code}}">
                                                            {{item.regionCode.region}}</option>
                                                    </select>
                                            </div>
                                            <input class="form-control" name="branchIdFilter" [(ngModel)]="branchCodeIdFilter"
                                                type="text" hidden />
                                        </div> -->

                                    </div>
                                </div>
                            </form>

                            <div class="row align-items-center">
                                <!--<Primeng-Datatable-Start>-->
                                <div class="primeng-datatable-container col-12" [busyIf]="primengTableHelper.isLoading">
                                    <p-table #dataTable (onLazyLoad)="getVMSDashboards($event)"
                                        [value]="primengTableHelper.records"
                                        rows="{{ primengTableHelper.defaultRecordsCountPerPage }}" [paginator]="false"
                                        [lazy]="true" [scrollable]="true" ScrollWidth="100%"
                                        [responsive]="primengTableHelper.isResponsive"
                                        [resizableColumns]="primengTableHelper.resizableColumns">
                                        <ng-template pTemplate="header">
                                            <ng-template pTemplate="header">
                                                <tr>
                                                    <th style="width: 130px">
                                                        {{ l("Actions") }}
                                                    </th>
                                                    <!-- <th style="width: 150px" pSortableColumn="branchFk.branchName">
                                                    {{ l("BranchName") }}
                                                    <p-sortIcon field="branchBranchName"></p-sortIcon>
                                                </th>
                                                <th style="width: 150px" pSortableColumn="serviceFk.serviceName">
                                                    {{ l("ServiceName") }}
                                                    <p-sortIcon field="serviceServiceName"></p-sortIcon>
                                                </th>
                                                <th style="width: 150px" pSortableColumn="appointmentDate">
                                                    {{ l("AppointmentDate") }}
                                                    <p-sortIcon field="branchAppointmentSetting.appointmentDate"></p-sortIcon>
                                                </th> -->
                                                </tr>
                                            </ng-template>
                                            <ng-template pTemplate="body" let-record="$implicit" let-i="rowIndex">
                                                <tr>
                                                    <td style="width: 130px">
                                                        <div class="btn-group dropdown" dropdown container="body">
                                                            <button class="dropdown-toggle btn btn-sm btn-primary"
                                                                dropdownToggle>
                                                                <i class="fa fa-cog"></i><span class="caret"></span>
                                                                {{ l("Actions") }}
                                                            </button>
                                                            <ul class="dropdown-menu" *dropdownMenu>
                                                                <li>
                                                                    <!-- <a href="javascript:;" class="dropdown-item" (click)="
                                                                        viewBranchAppointmentSettingModal.show(
                                                                            record
                                                                        )
                                                                    ">{{ l("View") }}</a> -->
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </td>
                                                    <td style="width: 150px">
                                                        <span class="ui-column-title">
                                                            {{ l("FullName") }}</span>
                                                        {{ record.fullName }}
                                                    </td>
                                                    <td style="width: 150px">
                                                        <span class="ui-column-title">
                                                            {{ l("ServiceName") }}</span>
                                                        {{ record.serviceServiceName }}
                                                    </td>
                                                    <td style="width: 150px">
                                                        <span class="ui-column-title">
                                                            {{ l("AppointmentDate") }}</span>
                                                        <span *ngIf="
                                                            record
                                                                .branchAppointmentSetting
                                                                .appointmentDate
                                                        ">
                                                            {{
                                                            record
                                                            .branchAppointmentSetting
                                                            .appointmentDate
                                                            | luxonFormat: "dd/MM/yyyy"
                                                            }}
                                                        </span>
                                                        <span *ngIf="
                                                            !record
                                                                .branchAppointmentSetting
                                                                .appointmentDate
                                                        ">-</span>
                                                    </td>
                                                </tr>
                                            </ng-template>
                                        </ng-template>
                                    </p-table>
                                    <div class="primeng-no-data" *ngIf="
                                            primengTableHelper.totalRecordsCount == 0
                                        ">
                                        {{ l("NoData") }}
                                    </div>
                                    <div class="primeng-paging-container">
                                        <p-paginator [rows]="
                                                primengTableHelper.defaultRecordsCountPerPage
                                            " #paginator (onPageChange)="
                                            getVMSDashboards($event)
                                            " [totalRecords]="
                                                primengTableHelper.totalRecordsCount
                                            " [rowsPerPageOptions]="
                                                primengTableHelper.predefinedRecordsCountPerPage
                                            ">
                                        </p-paginator>
                                        <span class="total-records-count">
                                            {{
                                            l(
                                            "TotalRecordsCount",
                                            primengTableHelper.totalRecordsCount
                                            )
                                            }}
                                        </span>
                                    </div>
                                </div>
                                <!--<Primeng-Datatable-End>-->
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
    <!-- <branchAppointmentSettingBranchLookupTableModal #branchAppointmentSettingBranchLookupTableModal
        (modalSave)="getNewBranchId()"></branchAppointmentSettingBranchLookupTableModal>
    <branchAppointmentSettingServiceLookupTableModal #branchAppointmentSettingServiceLookupTableModal
        (modalSave)="getNewServiceId()"></branchAppointmentSettingServiceLookupTableModal>
    <viewBranchAppointmentSettingModal #viewBranchAppointmentSettingModal></viewBranchAppointmentSettingModal> -->
</div>